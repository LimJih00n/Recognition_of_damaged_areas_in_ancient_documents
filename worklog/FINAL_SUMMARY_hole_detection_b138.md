# êµ¬ë© ê²€ì¶œ ìµœì¢… ì •ë¦¬: íŒŒë¼ë¯¸í„° ë° ë°©ë²•ë¡ 

**ì‘ì„±ì¼**: 2025-10-29
**ëª©ì **: ê³ ë¬¸ì„œ êµ¬ë© ê²€ì¶œ ìµœì  íŒŒë¼ë¯¸í„° ë° ì „ì²´ íŒŒì´í”„ë¼ì¸ ì •ë¦¬

---

## ğŸ“‹ ëª©ì°¨

1. [ìµœì¢… ê¶Œì¥ íŒŒë¼ë¯¸í„°](#ìµœì¢…-ê¶Œì¥-íŒŒë¼ë¯¸í„°)
2. [ì „ì²´ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸](#ì „ì²´-ì²˜ë¦¬-íŒŒì´í”„ë¼ì¸)
3. [íŒŒë¼ë¯¸í„° ê²°ì • ê³¼ì •](#íŒŒë¼ë¯¸í„°-ê²°ì •-ê³¼ì •)
4. [ë‹¤ì¤‘ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ê²°ê³¼](#ë‹¤ì¤‘-ì´ë¯¸ì§€-í…ŒìŠ¤íŠ¸-ê²°ê³¼)
5. [Edge Detection ë¹„êµ](#edge-detection-ë¹„êµ)
6. [ì‚¬ìš©ë²• ë° ì˜ˆì‹œ](#ì‚¬ìš©ë²•-ë°-ì˜ˆì‹œ)
7. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## ìµœì¢… ê¶Œì¥ íŒŒë¼ë¯¸í„°

### ğŸ† ì¼ë°˜ ë¬¸ì„œìš© (bí‰ê·  > 140)

```bash
python extract_whiteness_based.py \
  --method lab_b \
  --s-threshold 138 \
  --min-area 10 \
  --max-area 200000
```

| íŒŒë¼ë¯¸í„° | ê°’ | ì˜ë¯¸ | ì¤‘ìš”ë„ |
|---------|-----|------|--------|
| `--method` | `lab_b` | LAB b-channel ë‹¨ë… ì‚¬ìš© | â­â­â­ |
| `--s-threshold` | `138` | b<138ì¸ í”½ì…€ì„ êµ¬ë©ìœ¼ë¡œ íŒë‹¨ | â­â­â­ |
| `--min-area` | `10` | ìµœì†Œ êµ¬ë© í¬ê¸° (pixels) | â­â­ |
| `--max-area` | `200000` | ìµœëŒ€ êµ¬ë© í¬ê¸° (pixels) | â­â­â­ |

**ì ìš© ëŒ€ìƒ**: test_small, w_0001, w_0003, w_0005, w_0007, w_0015

---

### âš ï¸ ì‹¬ê°í•œ ì†ìƒ ë¬¸ì„œìš© (bí‰ê·  â‰ˆ 138)

```bash
python extract_whiteness_based.py \
  --method lab_b \
  --s-threshold 135 \
  --min-area 10 \
  --max-area 200000
```

**ë³€ê²½ ì‚¬í•­**: `--s-threshold 138 â†’ 135` (ë” ì—„ê²©í•˜ê²Œ)

**ì ìš© ëŒ€ìƒ**: w_0010 (b=138.2, Coverage 52.91%), w_0018 (b=137.8)

---

## ì „ì²´ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

### 7ë‹¨ê³„ ì²˜ë¦¬ ê³¼ì •

```
ì…ë ¥ ì´ë¯¸ì§€
    â†“
[1] LAB ìƒ‰ê³µê°„ ë³€í™˜
    â†“
[2] b-channel Threshold (b<138)
    â†“
[3] Morphological Operations (ì •ë¦¬)
    â†“
[4] Contour Detection (ìœ¤ê³½ì„  ì°¾ê¸°)
    â†“
[5] Size Filtering (í¬ê¸° í•„í„°)
    â†“
[6] ê°œë³„ êµ¬ë© ì¶”ì¶œ
    â†“
[7] yì¢Œí‘œ ì—­ìˆœ ì •ë ¬
    â†“
ê²°ê³¼ ì €ì¥
```

---

### ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…

#### [1] LAB ìƒ‰ê³µê°„ ë³€í™˜
```python
lab = cv2.cvtColor(image, cv2.COLOR_BGR2LAB)
L, a, b = cv2.split(lab)
```

**LAB ìƒ‰ê³µê°„**:
- **L**: Lightness (ëª…ë„) 0~100
- **a**: Green(-) â†” Red(+)
- **b**: Blue(-) â†” Yellow(+) â† **êµ¬ë© ê²€ì¶œì— ì‚¬ìš©**

**ì™œ LAB?**:
- RGBëŠ” ë°ê¸°ì™€ ìƒ‰ìƒì´ ì„ì—¬ìˆìŒ
- LABëŠ” ëª…ë„(L)ì™€ ìƒ‰ìƒ(a,b)ì´ ë¶„ë¦¬ë¨
- **b-channelë§Œìœ¼ë¡œ í°ìƒ‰ êµ¬ë©ê³¼ ë…¸ë€ ì¢…ì´ë¥¼ êµ¬ë¶„ ê°€ëŠ¥**

---

#### [2] b-channel Threshold
```python
b_thresh = 138  # ê³ ì •ê°’
white_mask = (b < b_thresh).astype(np.uint8) * 255
```

**ê²°ê³¼**: ì´ì§„ ë§ˆìŠ¤í¬ (binary mask)
- `255` (í°ìƒ‰): b<138ì¸ í”½ì…€ = êµ¬ë©
- `0` (ê²€ì€ìƒ‰): bâ‰¥138ì¸ í”½ì…€ = ì¢…ì´

**b=138ì˜ ë¬¼ë¦¬ì  ì˜ë¯¸**:
```
b < 128: íŒŒë€ìƒ‰ ê³„ì—´
b = 128: ì¤‘ë¦½ (íšŒìƒ‰)
b = 138: í°ìƒ‰~ì•½ê°„ ë…¸ë€ìƒ‰ â­ (ìš°ë¦¬ì˜ threshold)
b > 140: ë…¸ë€ìƒ‰/ë² ì´ì§€ìƒ‰ (ë³€ìƒ‰ëœ ì¢…ì´)
```

---

#### [3] Morphological Operations
```python
kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
mask_clean = cv2.morphologyEx(mask, cv2.MORPH_CLOSE, kernel)
mask_clean = cv2.morphologyEx(mask_clean, cv2.MORPH_OPEN, kernel)
```

**(1) MORPH_CLOSE (ë‹«ê¸°)**:
- ëª©ì : ì‘ì€ êµ¬ë©ì´ë‚˜ í‹ˆì„ ë©”ì›€
- íš¨ê³¼: ëŠì–´ì§„ ì˜ì—­ì„ ì—°ê²°

**(2) MORPH_OPEN (ì—´ê¸°)**:
- ëª©ì : ì‘ì€ ì  ë…¸ì´ì¦ˆ ì œê±°
- íš¨ê³¼: íŠ€ì–´ë‚˜ì˜¨ ì‘ì€ ì ë“¤ ì œê±°

**ì»¤ë„ í¬ê¸°**: 3x3 íƒ€ì›í˜• (ë³´ìˆ˜ì  ì •ë¦¬)

---

#### [4] Contour Detection
```python
contours, _ = cv2.findContours(mask_clean, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
```

**íŒŒë¼ë¯¸í„°**:
- `RETR_EXTERNAL`: ì™¸ê³½ ìœ¤ê³½ì„ ë§Œ (êµ¬ë© ì•ˆì˜ êµ¬ë©ì€ ë¬´ì‹œ)
- `CHAIN_APPROX_SIMPLE`: ìœ¤ê³½ì„  ë‹¨ìˆœí™” (ë©”ëª¨ë¦¬ ì ˆì•½)

---

#### [5] Size Filtering â­â­â­
```python
area = cv2.contourArea(cnt)
if area < min_area or area > max_area:
    excluded += 1
    continue
```

**í˜„ì¬ ì„¤ì •**:
- `min_area = 10` pixels (10í”½ì…€ ë¯¸ë§Œ ì œì™¸)
- `max_area = 200000` pixels (20ë§Œ í”½ì…€ ì´ˆê³¼ ì œì™¸)

**íš¨ê³¼**: **87-93% contour ê°ì†Œ!** (ê°€ì¥ ì¤‘ìš”í•œ ë‹¨ê³„!)

| ì´ë¯¸ì§€ | Filter ì „ | Filter í›„ | ê°ì†Œìœ¨ |
|--------|----------|----------|--------|
| w_0003 | 2,273 | 267 | **88%** |
| w_0007 | 5,182 | 367 | **93%** |
| w_0010 | 2,655 | 348 | **87%** |

---

#### [6] ê°œë³„ êµ¬ë© ì¶”ì¶œ
```python
x, y, bw, bh = cv2.boundingRect(cnt)
hole_region = image[y:y+bh, x:x+bw].copy()

# ë§ˆìŠ¤í¬ ì ìš© (ë°°ê²½ì„ í°ìƒ‰ìœ¼ë¡œ)
hole_extracted = hole_region.copy()
hole_extracted[hole_mask_small == 0] = [255, 255, 255]
```

**ì²˜ë¦¬ ê³¼ì •**:
1. êµ¬ë©ì˜ bounding box ê³„ì‚°
2. ì›ë³¸ ì´ë¯¸ì§€ì—ì„œ í•´ë‹¹ ì˜ì—­ë§Œ ì˜ë¼ëƒ„
3. êµ¬ë© ë¶€ë¶„ë§Œ ë‚¨ê¸°ê³  ë°°ê²½ì€ í°ìƒ‰ìœ¼ë¡œ ì±„ì›€

---

#### [7] yì¢Œí‘œ ì—­ìˆœ ì •ë ¬
```python
# yì¢Œí‘œ ì—­ìˆœ ì •ë ¬ (ì•„ë˜â†’ìœ„)
holes = sorted(holes, key=lambda h: h['bbox'][1], reverse=True)
# ID ì¬í• ë‹¹
for i, hole in enumerate(holes):
    hole['id'] = i
```

**ì •ë ¬ ê¸°ì¤€**: yì¢Œí‘œ (ì—­ìˆœ)
- hole_0000: yì¢Œí‘œ ê°€ì¥ í¼ (ë§¨ ì•„ë˜)
- hole_0001: yì¢Œí‘œ ë‘ ë²ˆì§¸ í¼
- ...
- hole_last: yì¢Œí‘œ ê°€ì¥ ì‘ìŒ (ë§¨ ìœ„)

**ëª©ì **: ì¼ê´€ëœ ID ë¶€ì—¬

---

## íŒŒë¼ë¯¸í„° ê²°ì • ê³¼ì •

### 1. Method ì„ íƒ: lab_b vs lab_hsv

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- `lab_hsv` (AND ì—°ì‚°): Coverage 18.45%
- `lab_b` (ë‹¨ë…): Coverage 32.40% â­

**ê²°ë¡ **: **lab_b ì„ íƒ**
- ë” ë§ì€ ì˜ì—­ ê²€ì¶œ
- êµ¬ë©ë§Œ ì •í™•íˆ í¬ì°©

---

### 2. Threshold ê²°ì •: Percentile vs Fixed

#### Percentile ë°©ì‹ (--s-percentile)
```bash
--s-percentile 33  # ê°€ì¥ í°ìƒ‰ì¸ 33% í”½ì…€
```

**ì¥ì **: ì´ë¯¸ì§€ì— ìë™ ì ì‘
**ë‹¨ì **: ì´ë¯¸ì§€ë§ˆë‹¤ ë‹¤ë¥¸ threshold

**test_small ê²°ê³¼**:
- p=33 â†’ b=140 ìë™ ê³„ì‚° â†’ 258ê°œ êµ¬ë©

**w_0005 ê²°ê³¼**:
- p=30~35 â†’ ëª¨ë‘ b=144 â†’ 18,920ê°œ êµ¬ë© âš ï¸ (ë„ˆë¬´ ë§ìŒ!)

**ë¬¸ì œ**: ë³€ìƒ‰ëœ ë¬¸ì„œì—ì„œëŠ” ì‹¤íŒ¨!

---

#### Fixed Threshold (--s-threshold)
```bash
--s-threshold 138  # ê³ ì •ê°’
```

**ì¥ì **:
- ëª¨ë“  ì´ë¯¸ì§€ì— ë™ì¼í•œ ê¸°ì¤€
- ì¬í˜„ì„± ì™„ë²½
- ë¬¼ë¦¬ì  ì˜ë¯¸ ëª…í™•

**test_small ê²°ê³¼**: 254ê°œ êµ¬ë©
**w_0005 ê²°ê³¼**: 239ê°œ êµ¬ë©

**ê²°ë¡ **: **ê³ ì • b=138 ì„ íƒ** â­â­â­

---

### 3. Threshold ê°’ ì„ íƒ: 130~140 ë¹„êµ

| Threshold | test_small | w_0005 | í‰ê°€ |
|-----------|-----------|--------|------|
| b=130 | 61ê°œ | 6,287ê°œ | âŒ ê·¹ë‹¨ì  |
| b=132 | 401ê°œ | 1,505ê°œ | âš ï¸ ë§ìŒ |
| b=135 | 241ê°œ | 249ê°œ | âœ… ê· í˜• |
| b=136 | 245ê°œ | 208ê°œ | âœ… ë¹„ìŠ· |
| b=137 | 251ê°œ | 221ê°œ | âœ… ë¹„ìŠ· |
| **b=138** | **254ê°œ** | **239ê°œ** | âœ…âœ… **ìµœì !** |
| b=140 | 258ê°œ | 877ê°œ | âš ï¸ w_0005 ë§ìŒ |

**ì„ íƒ ì´ìœ **:
- test_smallê³¼ w_0005ì—ì„œ **ê±°ì˜ ë™ì¼í•œ ê°œìˆ˜** (254 vs 239)
- ì¼ê´€ì„± ìµœê³ 
- ë‘ ì´ë¯¸ì§€ ëª¨ë‘ ì ë‹¹í•œ ê°œìˆ˜

---

### 4. min-area ì„¤ì •: 10 pixels

```bash
--min-area 10
```

**ì˜ë¯¸**: 10 pixels ë¯¸ë§Œì€ ë…¸ì´ì¦ˆë¡œ íŒë‹¨

**íš¨ê³¼**:
- w_0007: 853ê°œ â†’ 367ê°œ (486ê°œ ì œì™¸)
- ì‘ì€ ì  ë…¸ì´ì¦ˆ íš¨ê³¼ì  ì œê±°

**ê¶Œì¥**: **10** (ë„ˆë¬´ ë†’ì´ë©´ ì‘ì€ êµ¬ë© ë†“ì¹¨)

---

### 5. max-area ì„¤ì •: 100000 â†’ 200000

**ë¬¸ì œ ë°œê²¬**:
- w_0001: ìµœëŒ€ êµ¬ë© **71,158 px** (100k ë¯¸ë§Œì´ì§€ë§Œ í¼)
- w_0010: ìµœëŒ€ êµ¬ë© **73,984 px** (100k ë¯¸ë§Œì´ì§€ë§Œ í¼)

**í•´ê²°**: `--max-area 200000` â­â­â­

**ì´ìœ **:
- í° êµ¬ë©ë„ í¬í•¨
- 100kë¡œëŠ” ì œí•œì 
- 20ë§Œìœ¼ë¡œ ì¶©ë¶„í•œ ì—¬ìœ 

---

## ë‹¤ì¤‘ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ì „ì²´ ë¹„êµí‘œ

| ì´ë¯¸ì§€ | í¬ê¸° | í‰ê·  bê°’ | Coverage | êµ¬ë© ê°œìˆ˜ | ìµœëŒ€ êµ¬ë© | ì´ ì†ìƒ ë©´ì  | í‰ê°€ |
|--------|------|---------|----------|----------|----------|-------------|------|
| **test_small.jpg** | 1443x1082 | 141.7Â±7.6 | 32.40% | 254 | 2,477 px | 23,764 px (1.52%) | âœ… ê¸°ì¤€ |
| **w_0001.tif** | 7216x5412 | 141.6Â±7.9 | 32.70% | 335 | **71,158 px** | 753,494 px (1.93%) | âœ… í° êµ¬ë© |
| **w_0003.tif** | 7216x5412 | 143.8Â±6.6 | 15.56% | 267 | 49,840 px | 411,886 px (1.05%) | âœ… ì ë‹¹ |
| **w_0005.tif** | 7216x5412 | 144.1Â±6.7 | 15.89% | 239 | 17,676 px | 252,193 px (0.65%) | âœ… ì ë‹¹ |
| **w_0007.tif** | 7216x5412 | 143.5Â±6.0 | 14.28% | 367 | 61,350 px | 429,198 px (1.10%) | âœ… ì ë‹¹ |
| **w_0010.tif** | 7216x5412 | 138.2Â±8.0 | 52.91% | 348 | **73,984 px** | 431,252 px (1.10%) | âš ï¸ threshold ê·¼ì ‘ |
| **w_0015.tif** | 7216x5412 | 144.9Â±5.7 | 11.36% | 163 | 49,955 px | 211,946 px (0.54%) | âœ… ê°€ì¥ ë³€ìƒ‰ |
| **w_0018.tif** | 5412x7216 | 137.8Â±8.5 | 51.93% | **2,626** | 4,872 px | 140,263 px (0.36%) | âŒ ê³¼ê²€ì¶œ |

---

### ì´ë¯¸ì§€ ë¶„ë¥˜

#### âœ… ê·¸ë£¹ A: ê¹¨ë—í•œ ë°°ê²½ (bâ‰ˆ141-142)
- **test_small.jpg** (b=141.7)
- **w_0001.tif** (b=141.6)

**íŠ¹ì§•**:
- Coverage ë†’ìŒ (32%ëŒ€)
- êµ¬ë© 254-335ê°œ
- b=138 ìµœì 

---

#### âœ… ê·¸ë£¹ B: ë³€ìƒ‰ëœ ë°°ê²½ (bâ‰ˆ143-145)
- **w_0003.tif** (b=143.8)
- **w_0005.tif** (b=144.1)
- **w_0007.tif** (b=143.5)
- **w_0015.tif** (b=144.9)

**íŠ¹ì§•**:
- Coverage ë‚®ìŒ (11-16%)
- êµ¬ë© 163-367ê°œ
- ë°°ê²½ì´ ë…¸ë€ìƒ‰ìœ¼ë¡œ ë³€ìƒ‰
- b=138ë¡œ ì •í™•íˆ êµ¬ë¶„ ê°€ëŠ¥

---

#### âš ï¸ ê·¸ë£¹ C: ì‹¬ê°í•œ ì†ìƒ (bâ‰ˆ137-138)
- **w_0010.tif** (b=138.2, Coverage 52.91%)
- **w_0018.tif** (b=137.8, Coverage 51.93%)

**íŠ¹ì§•**:
- í‰ê·  bê°’ì´ thresholdì— ê·¼ì ‘
- Coverage 50%ëŒ€ (ì ˆë°˜ ì´ìƒ ì†ìƒ!)
- b=138ë¡œëŠ” ê³¼ê²€ì¶œ ê°€ëŠ¥

**ê¶Œì¥**: b=135 ì‚¬ìš©

---

### bê°’ê³¼ Coverageì˜ ê´€ê³„

```
í‰ê·  bê°’          Coverage    êµ¬ë© ê°œìˆ˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
137.8 (w_0018)    51.93%      2,626    âŒ
138.2 (w_0010)    52.91%        348    âš ï¸
141.6 (w_0001)    32.70%        335    âœ…
141.7 (test)      32.40%        254    âœ…
143.5 (w_0007)    14.28%        367    âœ…
143.8 (w_0003)    15.56%        267    âœ…
144.1 (w_0005)    15.89%        239    âœ…
144.9 (w_0015)    11.36%        163    âœ…
```

**íŒ¨í„´**:
- bí‰ê·  < 138: ê³¼ê²€ì¶œ (ì „ì²´ê°€ ì†ìƒ)
- bí‰ê·  â‰ˆ 140-142: Coverage ë†’ìŒ (32%ëŒ€)
- bí‰ê·  â‰ˆ 143-145: Coverage ë‚®ìŒ (11-16%)

**ê²°ë¡ **: **b=138ì€ bí‰ê· ì´ 140 ì´ìƒì¸ ë¬¸ì„œì— ìµœì **

---

## Edge Detection ë¹„êµ

### í…ŒìŠ¤íŠ¸í•œ ë°©ë²•ë“¤

1. **Morphological Gradient**: Dilation - Erosion
2. **Canny Edge**: Gradient + Non-max suppression
3. **Sobel Edge**: X/Y ë°©í–¥ gradient
4. **Direct Contours**: ê¸°ì¡´ ë°©ë²• (maskì—ì„œ ì§ì ‘)
5. **Enhanced Gradient**: Morphological gradient + Dilation

---

### ê²°ê³¼ ë¹„êµ

#### w_0003 (ê¸°ì¡´: 267ê°œ)
| ë°©ë²• | Contour ê°œìˆ˜ | Direct ëŒ€ë¹„ |
|------|-------------|------------|
| Enhanced Gradient | 1,847 | **-19%** âœ… |
| Sobel | 2,067 | -9% |
| Morph Gradient | 2,138 | -6% |
| Direct (ê¸°ì¡´) | 2,273 | ê¸°ì¤€ |
| Canny | 3,692 | +62% âš ï¸ |

#### w_0007 (ê¸°ì¡´: 367ê°œ)
| ë°©ë²• | Contour ê°œìˆ˜ | Direct ëŒ€ë¹„ |
|------|-------------|------------|
| Enhanced Gradient | 4,122 | **-20%** âœ… |
| Sobel | 4,577 | -12% |
| Morph Gradient | 4,740 | -9% |
| Direct (ê¸°ì¡´) | 5,182 | ê¸°ì¤€ |
| Canny | 7,613 | +47% âš ï¸ |

#### w_0010 (ê¸°ì¡´: 348ê°œ) âš ï¸ íŠ¹ì´ ì¼€ì´ìŠ¤!
| ë°©ë²• | Contour ê°œìˆ˜ | Direct ëŒ€ë¹„ |
|------|-------------|------------|
| **Direct (ê¸°ì¡´)** | **2,655** | **ê¸°ì¤€ (ìµœì†Œ!)** âœ… |
| Enhanced Gradient | 2,916 | +10% âš ï¸ |
| Sobel | 3,259 | +23% |
| Morph Gradient | 3,428 | +29% |
| Canny | 5,967 | +125% âš ï¸ |

---

### í•µì‹¬ ë°œê²¬

#### 1. Enhanced Gradient íš¨ê³¼

**ì¼ë°˜ ë¬¸ì„œ** (w_0003, w_0007): ì•½ 20% ê°ì†Œ âœ…
**ì‹¬ê°í•œ ì†ìƒ** (w_0010): ì˜¤íˆë ¤ 10% ì¦ê°€ âš ï¸

**ì´ìœ **:
- Enhanced GradientëŠ” í° êµ¬ë©ì˜ ê²½ê³„ë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë¶„í• 
- DirectëŠ” í° êµ¬ë©ì„ í•˜ë‚˜ë¡œ ìœ ì§€
- w_0010ì€ í° êµ¬ë©ì´ ë§ì•„ì„œ Directê°€ ë” íš¨ê³¼ì 

---

#### 2. Size Filterì˜ ì¤‘ìš”ì„± â­â­â­

| ì´ë¯¸ì§€ | Direct (filter ì „) | ì‹¤ì œ (filter í›„) | ê°ì†Œìœ¨ |
|--------|-------------------|-----------------|--------|
| w_0003 | 2,273 | 267 | **88%** |
| w_0007 | 5,182 | 367 | **93%** |
| w_0010 | 2,655 | 348 | **87%** |

**ê²°ë¡ **: **Size filterê°€ ê°€ì¥ ì¤‘ìš”í•œ ì—­í• !** (87-93% ê°ì†Œ)

---

#### 3. CannyëŠ” ë¹„ì¶”ì²œ

ëª¨ë“  ì´ë¯¸ì§€ì—ì„œ ê³¼ê²€ì¶œ:
- w_0003: +62%
- w_0007: +47%
- w_0010: +125%

**ì´ìœ **: ì‘ì€ ë…¸ì´ì¦ˆê¹Œì§€ ê²€ì¶œ

---

### ê¶Œì¥ ì‚¬í•­

#### âœ… ì¼ë°˜ ë¬¸ì„œ: í˜„ì¬ ë°©ë²• ìœ ì§€
```python
# Mask â†’ Morph CLOSE â†’ Morph OPEN â†’ Contours â†’ Size Filter
```

**ì´ìœ **:
- Size filterê°€ 87-93% ê°ì†Œ (í•µì‹¬!)
- ì•ˆì •ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥
- Enhanced GradientëŠ” size filter ì ìš© í›„ ì°¨ì´ ë¶ˆëª…í™•

---

#### ğŸ’¡ Enhanced Gradient: ì„ íƒì  í…ŒìŠ¤íŠ¸
```python
gradient = cv2.morphologyEx(mask, cv2.MORPH_GRADIENT, kernel)
gradient_thick = cv2.dilate(gradient, kernel, iterations=1)
```

**ì ìš© ì¡°ê±´**:
- ì¼ë°˜ ë¬¸ì„œì—ì„œë§Œ (bí‰ê·  > 140)
- ì‹¬ê°í•œ ì†ìƒ ë¬¸ì„œì—ëŠ” ë¹„ì¶”ì²œ

---

#### âŒ Canny: ì‚¬ìš© ì•ˆ í•¨
ëª¨ë“  ê²½ìš° ê³¼ê²€ì¶œ

---

## ì‚¬ìš©ë²• ë° ì˜ˆì‹œ

### 1. ë‹¨ì¼ ì´ë¯¸ì§€ ì²˜ë¦¬

```bash
python extract_whiteness_based.py \
  --input "datasets/test_small.jpg" \
  --output-dir "results/test_small_output" \
  --method lab_b \
  --s-threshold 138 \
  --min-area 10 \
  --max-area 200000
```

**ì¶œë ¥**:
```
results/test_small_output/
â”œâ”€â”€ comparison.png          # ì›ë³¸ vs êµ¬ë© í‘œì‹œ
â”œâ”€â”€ white_mask.png          # ì´ì§„ ë§ˆìŠ¤í¬
â””â”€â”€ individual_holes/       # ê°œë³„ êµ¬ë© ì´ë¯¸ì§€
    â”œâ”€â”€ hole_0000_x390_y892_w23_h18_a287.png
    â”œâ”€â”€ hole_0001_x422_y890_w25_h23_a384.png
    â””â”€â”€ ...
```

---

### 2. ë°°ì¹˜ ì²˜ë¦¬ (ì—¬ëŸ¬ ì´ë¯¸ì§€)

#### Windows (PowerShell)
```powershell
Get-ChildItem "datasets\1ì²©\*.tif" | ForEach-Object {
    $name = $_.BaseName
    python extract_whiteness_based.py `
      --input $_.FullName `
      --output-dir "results\${name}_b138" `
      --method lab_b `
      --s-threshold 138 `
      --min-area 10 `
      --max-area 200000
}
```

#### Linux/Mac (Bash)
```bash
for img in datasets/1ì²©/*.tif; do
    name=$(basename "$img" .tif)
    python extract_whiteness_based.py \
      --input "$img" \
      --output-dir "results/${name}_b138" \
      --method lab_b \
      --s-threshold 138 \
      --min-area 10 \
      --max-area 200000
done
```

---

### 3. ì‹¬ê°í•œ ì†ìƒ ë¬¸ì„œ ì²˜ë¦¬

```bash
# w_0010, w_0018 ê°™ì€ ê²½ìš°
python extract_whiteness_based.py \
  --input "datasets/1ì²©/w_0010.tif" \
  --output-dir "results/w_0010_b135" \
  --method lab_b \
  --s-threshold 135 \    # 138 â†’ 135ë¡œ ë‚®ì¶¤
  --min-area 10 \
  --max-area 200000
```

---

### 4. Edge Detection í…ŒìŠ¤íŠ¸

```bash
# ê¸°ì¡´ ê²°ê³¼ì˜ maskë¡œ edge detection í…ŒìŠ¤íŠ¸
python test_edge_detection.py \
  "results/test_small_output/white_mask.png" \
  "edge_test_output"
```

**ì¶œë ¥**:
```
edge_test_output/
â”œâ”€â”€ comparison_edges.png       # Edge ë°©ë²• ë¹„êµ
â”œâ”€â”€ comparison_contours.png    # Contour ê²°ê³¼ ë¹„êµ
â”œâ”€â”€ 1_morphological_gradient.png
â”œâ”€â”€ 2_canny_edges.png
â”œâ”€â”€ 3_sobel_edges.png
â””â”€â”€ ...
```

---

## ë¬¸ì œ í•´ê²°

### Q1. êµ¬ë©ì´ ë„ˆë¬´ ë§ì´ ê²€ì¶œë¨

**ì›ì¸**:
- Thresholdê°€ ë„ˆë¬´ ë†’ìŒ
- ë°°ê²½ì´ ë„ˆë¬´ ì–´ë‘¡ê±°ë‚˜ ë…¸ë€ìƒ‰

**í•´ê²°**:
```bash
# bê°’ì„ ë‚®ì¶°ì„œ ë” ì—„ê²©í•˜ê²Œ
--s-threshold 135  # ë˜ëŠ” 132, 130
```

**í™•ì¸ ë°©ë²•**:
```bash
# ì—¬ëŸ¬ threshold í…ŒìŠ¤íŠ¸
python extract_whiteness_based.py ... --s-threshold 135 --output-dir results/test_b135
python extract_whiteness_based.py ... --s-threshold 138 --output-dir results/test_b138
python extract_whiteness_based.py ... --s-threshold 140 --output-dir results/test_b140

# ê° ê²°ê³¼ì˜ comparison.png ë¹„êµ
```

---

### Q2. êµ¬ë©ì„ ë†“ì¹¨ (ë„ˆë¬´ ì ê²Œ ê²€ì¶œ)

**ì›ì¸**:
- Thresholdê°€ ë„ˆë¬´ ë‚®ìŒ
- min-areaê°€ ë„ˆë¬´ í¼

**í•´ê²°**:
```bash
# bê°’ì„ ë†’ì—¬ì„œ ë” ê´€ëŒ€í•˜ê²Œ
--s-threshold 140  # ë˜ëŠ” 142, 145

# ë˜ëŠ” min-area ì¤„ì´ê¸°
--min-area 5  # ê¸°ë³¸ê°’ 10 â†’ 5
```

---

### Q3. í° êµ¬ë©ì´ ëˆ„ë½ë¨

**ì›ì¸**: max-areaê°€ ë„ˆë¬´ ì‘ìŒ

**í•´ê²°**:
```bash
# max-area ì¦ê°€
--max-area 300000  # ë˜ëŠ” ë” í¬ê²Œ
```

**í™•ì¸ ë°©ë²•**:
ì¶œë ¥ ë¡œê·¸ì—ì„œ "Area range" í™•ì¸
```
Area range: 10 - 73984
```
â†’ ìµœëŒ€ êµ¬ë©ì´ 73,984 pixelsì´ë¯€ë¡œ max-areaëŠ” 100,000 ì´ìƒ í•„ìš”

---

### Q4. ì „ì²´ê°€ ì†ìƒëœ ë¬¸ì„œ (Coverage > 50%)

**ì¦ìƒ**:
- Coverage 50% ì´ìƒ
- í‰ê·  bê°’ì´ thresholdì— ê·¼ì ‘
- êµ¬ë©ì´ ë„ˆë¬´ ë§ìŒ

**ì˜ˆì‹œ**: w_0010 (b=138.2, 52.91%), w_0018 (b=137.8, 51.93%)

**í•´ê²°**:
```bash
# Thresholdë¥¼ í¬ê²Œ ë‚®ì¶¤
--s-threshold 135  # ë˜ëŠ” 130

# ë˜ëŠ” ë‹¤ë¥¸ ë°©ë²• ì‹œë„ (edge detection ë“±)
```

---

### Q5. ì‘ì€ ë…¸ì´ì¦ˆê°€ ë§ìŒ

**ì›ì¸**: min-areaê°€ ë„ˆë¬´ ì‘ìŒ

**í•´ê²°**:
```bash
# min-area ì¦ê°€
--min-area 20  # ë˜ëŠ” 30
```

**í™•ì¸ ë°©ë²•**:
ì¶œë ¥ ë¡œê·¸ì—ì„œ "Excluded (size)" í™•ì¸
```
Total contours: 853
Valid holes: 367
Excluded (size): 486  â† 486ê°œê°€ í¬ê¸°ë¡œ ì œì™¸ë¨
```

---

## íŒŒì¼ êµ¬ì¡°

### ì½”ë“œ íŒŒì¼
```
extract_whiteness_based.py    # ë©”ì¸ êµ¬ë© ê²€ì¶œ ìŠ¤í¬ë¦½íŠ¸
test_edge_detection.py        # Edge detection í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
compare_masks.py              # Mask ë¹„êµ ìŠ¤í¬ë¦½íŠ¸
```

### Worklog (ë¬¸ì„œ)
```
worklog/
â”œâ”€â”€ FINAL_SUMMARY_hole_detection_b138.md           # ì´ ë¬¸ì„œ â­
â”œâ”€â”€ current_pipeline_b138.md                       # íŒŒì´í”„ë¼ì¸ ìƒì„¸
â”œâ”€â”€ what_are_b_and_p.md                            # bì™€ p ì„¤ëª…
â”œâ”€â”€ 2025-10-29_FINAL_all_combinations_b138_p30_35.md
â”œâ”€â”€ 2025-10-29_threshold_comparison_130_to_140.md
â”œâ”€â”€ 2025-10-29_multiple_images_test_b138.md
â”œâ”€â”€ 2025-10-29_edge_detection_comparison.md
â””â”€â”€ 2025-10-29_edge_detection_better_testset.md
```

### ê²°ê³¼ ë””ë ‰í† ë¦¬
```
results/
â”œâ”€â”€ test_small_b138_maxarea200k/
â”‚   â”œâ”€â”€ comparison.png
â”‚   â”œâ”€â”€ white_mask.png
â”‚   â””â”€â”€ individual_holes/
â”œâ”€â”€ w_0001_b138/
â”œâ”€â”€ w_0003_b138/
â”œâ”€â”€ w_0005_b138/
â”œâ”€â”€ w_0007_b138/
â”œâ”€â”€ w_0010_b138/
â”œâ”€â”€ w_0015_b138/
â””â”€â”€ w_0018_b138/

edge_test_small/
edge_test_w0003/
edge_test_w0005/
edge_test_w0007/
edge_test_w0010/
```

---

## í•µì‹¬ ìš”ì•½

### ìµœì¢… íŒŒë¼ë¯¸í„° â­â­â­
```bash
--method lab_b \
--s-threshold 138 \
--min-area 10 \
--max-area 200000
```

### ê°€ì¥ ì¤‘ìš”í•œ ê²ƒë“¤
1. **b=138**: test_smallê³¼ w_0005ì—ì„œ ê±°ì˜ ë™ì¼í•œ ê°œìˆ˜ (254 vs 239)
2. **max-area=200000**: í° êµ¬ë© í¬í•¨ (71k, 73k pixels)
3. **Size filter**: 87-93% contour ê°ì†Œ (ê°€ì¥ ì¤‘ìš”!)

### ì ìš© ëŒ€ìƒ
- **ì¼ë°˜ ë¬¸ì„œ** (bí‰ê·  > 140): b=138 âœ…
- **ì‹¬ê°í•œ ì†ìƒ** (bí‰ê·  â‰ˆ 138): b=135 âš ï¸

### ê¶Œì¥ ë°©ë²•
- **í˜„ì¬ íŒŒì´í”„ë¼ì¸ ìœ ì§€** âœ…
- **Enhanced Gradient**: ì„ íƒì  í…ŒìŠ¤íŠ¸ ğŸ’¡
- **Canny**: ì‚¬ìš© ì•ˆ í•¨ âŒ

---

## ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- `current_pipeline_b138.md`: ì „ì²´ íŒŒì´í”„ë¼ì¸ ìƒì„¸ ì„¤ëª…
- `what_are_b_and_p.md`: b-channelê³¼ percentile ì„¤ëª…
- `2025-10-29_multiple_images_test_b138.md`: 8ê°œ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ê²°ê³¼
- `2025-10-29_edge_detection_better_testset.md`: Edge detection ë¹„êµ

### í™•ì¸í•´ì•¼ í•  ì´ë¯¸ì§€
```
results/*/comparison.png          # ê° ê²°ê³¼ì˜ ì‹œê°ì  ë¹„êµ
edge_test_*/comparison_contours.png  # Edge detection ë¹„êµ
```

### ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸
```bash
# ë‹¨ì¼ ì´ë¯¸ì§€
python extract_whiteness_based.py --input IMAGE --output-dir OUTPUT --method lab_b --s-threshold 138 --min-area 10 --max-area 200000

# ë°°ì¹˜ ì²˜ë¦¬ (PowerShell)
Get-ChildItem "datasets\1ì²©\*.tif" | ForEach-Object { python extract_whiteness_based.py --input $_.FullName --output-dir "results\$($_.BaseName)_b138" --method lab_b --s-threshold 138 --min-area 10 --max-area 200000 }

# Edge detection í…ŒìŠ¤íŠ¸
python test_edge_detection.py "results/OUTPUT/white_mask.png" "edge_test_output"
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-10-29
**í…ŒìŠ¤íŠ¸ ì™„ë£Œ**: test_small, w_0001, w_0003, w_0005, w_0007, w_0010, w_0015, w_0018
**ê¶Œì¥ íŒŒë¼ë¯¸í„°**: b=138, min=10, max=200000
