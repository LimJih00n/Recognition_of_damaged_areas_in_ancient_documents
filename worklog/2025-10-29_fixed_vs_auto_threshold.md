# 고정 vs 자동 Threshold 비교

**작성일**: 2025-10-29

---

## 비교 대상

### 자동 Threshold (Percentile 방식)
- 파라미터: `--s-percentile 33`
- 각 이미지마다 p33 지점을 계산하여 threshold 결정
- 이미지별로 다른 threshold 사용

### 고정 Threshold (절대값 방식)
- 파라미터: `--s-threshold [값]`
- 모든 이미지에 동일한 절대값 threshold 사용
- 이미지와 무관하게 고정

---

## 실험 결과

### test_small.jpg (평균 b=141.7)

| Threshold | 구멍 개수 | Coverage | 비고 |
|-----------|----------|----------|------|
| **자동 (p33)** → b<140 | 258개 | 32.91% | ✅ 적절 |
| **고정 b=140** | 258개 | 32.91% | ✅ 동일 (우연히 일치) |
| **고정 b=144** | 483개 | 37.57% | ⚠️ +87% (너무 많음) |

### w_0005.tif (평균 b=144.1)

| Threshold | 구멍 개수 | Coverage | 비고 |
|-----------|----------|----------|------|
| **자동 (p33)** → b<144 | 18,920개 | 26.64% | ✅ 적절 |
| **고정 b=140** | 877개 | 16.20% | ❌ -95% (너무 적음) |
| **고정 b=144** | 18,920개 | 26.64% | ✅ 동일 |

---

## 문제점: 이미지별 b값 분포 차이

### test_small.jpg
```
평균 b: 141.7 ± 7.6
p33: 140
→ 권장 고정값: b=140
```

### w_0005.tif
```
평균 b: 144.1 ± 6.7
p33: 144
→ 권장 고정값: b=144
```

**결론**: 이미지마다 색상 분포가 다르기 때문에, **하나의 고정값으로 모든 이미지를 처리하기 어렵습니다**.

---

## 장단점 비교

### 자동 Threshold (Percentile)

**장점**:
- ✅ 이미지별로 자동 적응
- ✅ 색상 분포가 다른 이미지들에 일관된 기준 적용
- ✅ 얼룩진 정도가 다른 문서들을 균일하게 처리
- ✅ 사용자가 threshold 값을 고민할 필요 없음

**단점**:
- ⚠️ 이미지마다 다른 threshold 사용 (일관성 문제)
- ⚠️ 극단적인 이미지에서 이상한 값 나올 수 있음
- ⚠️ 재현성이 떨어짐 (다른 이미지에 적용 시 threshold 달라짐)

### 고정 Threshold (절대값)

**장점**:
- ✅ 모든 이미지에 동일한 기준 적용
- ✅ 재현성 높음 (항상 같은 값)
- ✅ 물리적 의미 명확 (b=140 = "이 정도로 흰색")

**단점**:
- ❌ 이미지마다 적절한 값이 다름
- ❌ 얼룩진 정도에 따라 수동 조정 필요
- ❌ 한 값으로는 다양한 이미지 처리 불가능

---

## 권장 사항

### Case 1: 유사한 문서들 (같은 종류, 같은 스캔)
→ **고정 Threshold** 사용
- 한번 적절한 값을 찾으면 계속 사용
- 예: 같은 고문서 컬렉션

### Case 2: 다양한 문서들 (종류/상태 다름)
→ **자동 Threshold (Percentile)** 사용
- 각 이미지에 자동 적응
- 예: 여러 출처의 문서들

### Case 3: 정밀 분석 필요
→ **이미지별로 최적값 수동 설정**
```bash
# test_small용
python extract_whiteness_based.py --s-threshold 140 ...

# w_0005용
python extract_whiteness_based.py --s-threshold 144 ...
```

---

## 현재 상황에 적합한 방법

**현재 데이터**:
- test_small.jpg: 작은 샘플 (평균 b=141.7)
- w_0005.tif: 실제 고해상도 문서 (평균 b=144.1)

**추천**:
1. **Percentile 방식 유지** (--s-percentile 33)
   - 이미지마다 자동 적응
   - 새로운 이미지 추가되어도 안정적

2. 또는 **이미지별 고정값**:
   - test_small: --s-threshold 140
   - w_0005: --s-threshold 144

---

## 해진 부분 더 검출하려면?

**질문**: "해진 부분 디텍팅하는 거는 p를 키워야하는 거가?"

**답변**: 맞습니다!

### Percentile 값의 의미
- **p25** (기본): 하위 25% = 가장 흰 부분만
- **p33** (현재): 하위 33% = 약간 더 노란 부분까지
- **p40**: 하위 40% = 더 노란 부분까지
- **p50**: 하위 50% = 중간 정도까지

### 더 많이 검출하려면
```bash
# 더 많이 검출 (베이지색에 가까운 부분도 포함)
--s-percentile 40  # 또는 45, 50

# 고정값으로는
--s-threshold 145  # 또는 150
```

**주의**: p를 너무 높이면 정상 종이 부분도 구멍으로 오검출됩니다!

---

## 결론

- **자동 (p33)**: 이미지마다 자동 적응, 권장 ⭐
- **고정 (b=140 또는 144)**: 특정 이미지에 최적화, 일관성 필요시
- **해진 부분 더 검출**: p 값을 높이거나 (35~40), threshold를 높임 (145~150)
