# ê³ ë¬¸ì„œ ì†ìƒ ê²€ì¶œ ì‹œìŠ¤í…œ - ë‹¤ìŒ ë‹¨ê³„ ê³„íš

**ì‘ì„±ì¼**: 2025-10-30
**í˜„ì¬ ìƒíƒœ**: íƒ€ì¼ ê²½ê³„ ê°ì§€ + SVG ë²¡í„°í™” ì™„ë£Œ

---

## ğŸ“‹ ëª©ì°¨

1. [í˜„ì¬ ì™„ì„±ëœ ê¸°ëŠ¥](#í˜„ì¬-ì™„ì„±ëœ-ê¸°ëŠ¥)
2. [ë‹¤ìŒ ë‹¨ê³„ ê°œìš”](#ë‹¤ìŒ-ë‹¨ê³„-ê°œìš”)
3. [Phase 1: ì „ì²´ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸](#phase-1-ì „ì²´-ì´ë¯¸ì§€-í…ŒìŠ¤íŠ¸)
4. [Phase 2: ì‹œê°í™” ê°œì„ ](#phase-2-ì‹œê°í™”-ê°œì„ )
5. [Phase 3: ì‹¤ìš©í™” (ë°°í¬)](#phase-3-ì‹¤ìš©í™”-ë°°í¬)
6. [íƒ€ì„ë¼ì¸](#íƒ€ì„ë¼ì¸)
7. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)

---

## í˜„ì¬ ì™„ì„±ëœ ê¸°ëŠ¥

### âœ… í•µì‹¬ ê¸°ëŠ¥
- [x] LAB b-channel ê¸°ë°˜ êµ¬ë© ê°ì§€ (b < 138)
- [x] íƒ€ì¼ ìŠ¤ìº” ì´ë¯¸ì§€ ê²½ê³„ ìë™ ê°ì§€
- [x] í•´ìƒë„ ìë™ ìŠ¤ì¼€ì¼ë§
- [x] SVG ë²¡í„° ì¶œë ¥ (ì›ë³¸ í˜•íƒœ ë³´ì¡´)
- [x] ê°œë³„ SVG ì¤‘ì•™ ë°°ì¹˜
- [x] êµ¬ë© ë²ˆí˜¸ ì¶”ì  ë° ì‹œê°í™”
- [x] í•œê¸€ ê²½ë¡œ ì§€ì›

### âœ… ì²˜ë¦¬ëœ ì´ë¯¸ì§€
- test_small.jpg (1443x1082) - 268ê°œ êµ¬ë©
- w_0001.tif (7216x5412) - 297ê°œ êµ¬ë©
- w_0002.tif (7216x5412) - 260ê°œ êµ¬ë©
- w_0003.tif (7216x5412) - 188ê°œ êµ¬ë©
- w_0005.tif (7216x5412) - 163ê°œ êµ¬ë©

### âœ… ì¶œë ¥ ê²°ê³¼
- PNG ë§ˆìŠ¤í¬ (í‘ë°±)
- SVG ë²¡í„° (í†µí•© + ê°œë³„)
- ë¹„êµ ì´ë¯¸ì§€ (ì›ë³¸ vs ê²€ì¶œ)
- ê²½ê³„ ì‹œê°í™”
- ê²€ì¦ ì´ë¯¸ì§€ (ë²ˆí˜¸ í‘œì‹œ)

---

## ë‹¤ìŒ ë‹¨ê³„ ê°œìš”

```
Phase 1: ì „ì²´ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ (1-2ì¼)
  â”œâ”€ ëª¨ë“  ì´ë¯¸ì§€ ì¼ê´„ ì²˜ë¦¬
  â”œâ”€ ê²°ê³¼ í’ˆì§ˆ ê²€ì¦
  â””â”€ í†µê³„ ë¶„ì„

Phase 2: ì‹œê°í™” ê°œì„  (1-2ì¼)
  â”œâ”€ ì›ë³¸ + ë§ˆìŠ¤í¬ ì˜¤ë²„ë ˆì´
  â”œâ”€ ì¸í„°ë™í‹°ë¸Œ ë¹„êµ ë·°ì–´
  â””â”€ ë³´ê³ ì„œ ìë™ ìƒì„±

Phase 3: ì‹¤ìš©í™” - ë°°í¬ (3-5ì¼)
  â”œâ”€ Option A: ì›¹ ì„œë¹„ìŠ¤
  â”œâ”€ Option B: ë°ìŠ¤í¬í†± ì•±
  â””â”€ Option C: CLI ë„êµ¬ + GUI
```

---

## Phase 1: ì „ì²´ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸

### ëª©í‘œ
- datasets í´ë”ì˜ ëª¨ë“  ì´ë¯¸ì§€ ì²˜ë¦¬
- í’ˆì§ˆ ê²€ì¦ ë° í†µê³„ ìˆ˜ì§‘
- ë¬¸ì œì  ë°œê²¬ ë° ìˆ˜ì •

---

### 1.1 ë°°ì¹˜ ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸

**íŒŒì¼**: `batch_process.py`

```python
"""
ëª¨ë“  ì´ë¯¸ì§€ ìë™ ì²˜ë¦¬

ì‚¬ìš©ë²•:
    python batch_process.py --input-dir datasets/1ì²© --output-dir results/batch_1
"""

import os
import glob
import subprocess
from pathlib import Path

def process_all_images(input_dir, output_dir, params):
    """í´ë” ë‚´ ëª¨ë“  ì´ë¯¸ì§€ ì²˜ë¦¬"""

    # ì´ë¯¸ì§€ íŒŒì¼ ì°¾ê¸°
    images = glob.glob(f"{input_dir}/**/*.tif", recursive=True)
    images += glob.glob(f"{input_dir}/**/*.jpg", recursive=True)

    print(f"Found {len(images)} images")

    results = []

    for i, image_path in enumerate(images, 1):
        print(f"\n[{i}/{len(images)}] Processing: {image_path}")

        # ì¶œë ¥ ë””ë ‰í† ë¦¬ ìƒì„±
        image_name = Path(image_path).stem
        out_dir = f"{output_dir}/{image_name}"

        # ì²˜ë¦¬ ëª…ë ¹ ì‹¤í–‰
        cmd = [
            "python", "extract_whiteness_based.py",
            "--input", image_path,
            "--method", "lab_b",
            "--s-threshold", str(params['threshold']),
            "--min-area", str(params['min_area']),
            "--max-area", str(params['max_area']),
            "--crop-document",
            "--corner-method", "edges",
            "--export-svg",
            "--svg-simplify", str(params['svg_simplify']),
            "--svg-individual",
            "--output-dir", out_dir
        ]

        try:
            result = subprocess.run(cmd, capture_output=True, text=True, timeout=300)

            # ê²°ê³¼ íŒŒì‹±
            holes = extract_hole_count(result.stdout)

            results.append({
                'image': image_name,
                'holes': holes,
                'status': 'success' if result.returncode == 0 else 'failed'
            })

        except Exception as e:
            print(f"Error: {e}")
            results.append({
                'image': image_name,
                'status': 'error',
                'error': str(e)
            })

    # ê²°ê³¼ ì €ì¥
    save_batch_report(results, output_dir)

    return results


def save_batch_report(results, output_dir):
    """ë°°ì¹˜ ì²˜ë¦¬ ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±"""

    report = f"""# ë°°ì¹˜ ì²˜ë¦¬ ê²°ê³¼

ì²˜ë¦¬ ì¼ì‹œ: {datetime.now()}
ì´ ì´ë¯¸ì§€: {len(results)}
ì„±ê³µ: {sum(1 for r in results if r['status'] == 'success')}
ì‹¤íŒ¨: {sum(1 for r in results if r['status'] != 'success')}

## ìƒì„¸ ê²°ê³¼

| ì´ë¯¸ì§€ | êµ¬ë© ê°œìˆ˜ | ìƒíƒœ |
|--------|----------|------|
"""

    for r in results:
        holes = r.get('holes', '-')
        report += f"| {r['image']} | {holes} | {r['status']} |\n"

    with open(f"{output_dir}/batch_report.md", "w", encoding="utf-8") as f:
        f.write(report)

    print(f"\nReport saved: {output_dir}/batch_report.md")


if __name__ == '__main__':
    # íŒŒë¼ë¯¸í„° ì„¤ì •
    params = {
        'threshold': 138,
        'min_area': 50,
        'max_area': 2500000,
        'svg_simplify': 0.1
    }

    # ì‹¤í–‰
    process_all_images("datasets/1ì²©", "results/batch_1", params)
```

---

### 1.2 í’ˆì§ˆ ê²€ì¦

**íŒŒì¼**: `verify_batch_results.py`

```python
"""
ë°°ì¹˜ ì²˜ë¦¬ ê²°ê³¼ í’ˆì§ˆ ê²€ì¦

- ëª¨ë“  SVG íŒŒì¼ ê²€ì¦
- í†µê³„ ìˆ˜ì§‘
- ì´ìƒì¹˜ ê°ì§€
"""

def verify_batch_quality(results_dir):
    """ê²°ê³¼ í’ˆì§ˆ ê²€ì¦"""

    issues = []
    stats = []

    for result_dir in glob.glob(f"{results_dir}/*"):
        # í•„ìˆ˜ íŒŒì¼ í™•ì¸
        required = [
            'all_holes_vector.svg',
            'comparison.png',
            'document_boundary.png'
        ]

        for file in required:
            if not os.path.exists(f"{result_dir}/{file}"):
                issues.append(f"Missing: {result_dir}/{file}")

        # í†µê³„ ìˆ˜ì§‘
        stats_file = f"{result_dir}/stats.json"
        if os.path.exists(stats_file):
            with open(stats_file) as f:
                stats.append(json.load(f))

    # ì´ìƒì¹˜ ê°ì§€
    hole_counts = [s['total_holes'] for s in stats]
    mean = np.mean(hole_counts)
    std = np.std(hole_counts)

    for s in stats:
        if abs(s['total_holes'] - mean) > 3 * std:
            issues.append(f"Outlier: {s['image']} has {s['total_holes']} holes")

    return issues, stats
```

---

### 1.3 í†µê³„ ë¶„ì„

**ìƒì„±í•  í†µê³„**:
- ì´ë¯¸ì§€ë³„ êµ¬ë© ê°œìˆ˜
- êµ¬ë© í¬ê¸° ë¶„í¬
- íƒ€ì¼ ê²½ê³„ ê°ì§€ ì„±ê³µë¥ 
- í‰ê·  ì²˜ë¦¬ ì‹œê°„
- SVG íŒŒì¼ í¬ê¸°

**ì¶œë ¥**: `results/batch_1/statistics.md`

---

## Phase 2: ì‹œê°í™” ê°œì„ 

### ëª©í‘œ
- ì›ë³¸ ì´ë¯¸ì§€ì— ë§ˆìŠ¤í¬ ì˜¤ë²„ë ˆì´
- ì¸í„°ë™í‹°ë¸Œ ë¹„êµ ê¸°ëŠ¥
- ìë™ ë³´ê³ ì„œ ìƒì„±

---

### 2.1 ë§ˆìŠ¤í¬ ì˜¤ë²„ë ˆì´

**íŒŒì¼**: `create_overlay.py`

```python
"""
ì›ë³¸ ì´ë¯¸ì§€ì— êµ¬ë© ë§ˆìŠ¤í¬ ì˜¤ë²„ë ˆì´

ì¶œë ¥:
  - overlay_red.png: ë¹¨ê°„ìƒ‰ ë°˜íˆ¬ëª…
  - overlay_heatmap.png: íˆíŠ¸ë§µ
  - side_by_side.png: ì›ë³¸ | ì˜¤ë²„ë ˆì´
"""

def create_mask_overlay(image_path, mask_path, output_path):
    """ì›ë³¸ + ë§ˆìŠ¤í¬ ì˜¤ë²„ë ˆì´ ìƒì„±"""

    # ì´ë¯¸ì§€ ë¡œë“œ
    image = cv2.imread(image_path)
    mask = cv2.imread(mask_path, cv2.IMREAD_GRAYSCALE)

    # 1. ë¹¨ê°„ìƒ‰ ë°˜íˆ¬ëª… ì˜¤ë²„ë ˆì´
    overlay_red = image.copy()
    overlay_red[mask > 0] = [0, 0, 255]  # ë¹¨ê°„ìƒ‰
    result = cv2.addWeighted(image, 0.7, overlay_red, 0.3, 0)
    cv2.imwrite(f"{output_path}_red.png", result)

    # 2. íˆíŠ¸ë§µ (êµ¬ë© ë°€ë„)
    heatmap = cv2.applyColorMap(mask, cv2.COLORMAP_JET)
    result = cv2.addWeighted(image, 0.5, heatmap, 0.5, 0)
    cv2.imwrite(f"{output_path}_heatmap.png", result)

    # 3. Side-by-side ë¹„êµ
    side_by_side = np.hstack([image, overlay_red])
    cv2.imwrite(f"{output_path}_side_by_side.png", side_by_side)
```

**ì˜ˆì‹œ ì¶œë ¥**:
```
results/w_0001/
â”œâ”€â”€ overlay_red.png           # ì›ë³¸ + ë¹¨ê°„ ë§ˆìŠ¤í¬ (70% + 30%)
â”œâ”€â”€ overlay_heatmap.png        # íˆíŠ¸ë§µ ìŠ¤íƒ€ì¼
â””â”€â”€ side_by_side.png           # ì›ë³¸ | ì˜¤ë²„ë ˆì´ ë¹„êµ
```

---

### 2.2 ì¸í„°ë™í‹°ë¸Œ ë¹„êµ ë·°ì–´

**íŒŒì¼**: `html_viewer.py`

```python
"""
HTML ì¸í„°ë™í‹°ë¸Œ ë·°ì–´ ìƒì„±

ê¸°ëŠ¥:
  - ìŠ¬ë¼ì´ë”ë¡œ ì›ë³¸/ë§ˆìŠ¤í¬ ë¹„êµ
  - êµ¬ë© í´ë¦­ â†’ ìƒì„¸ ì •ë³´
  - SVG ë‹¤ìš´ë¡œë“œ ë§í¬
"""

def create_html_viewer(result_dir):
    """HTML ë·°ì–´ ìƒì„±"""

    html = f"""
<!DOCTYPE html>
<html>
<head>
    <title>êµ¬ë© ê²€ì¶œ ê²°ê³¼</title>
    <style>
        .container {{ max-width: 1200px; margin: 0 auto; }}
        .slider {{ width: 100%; }}
        #canvas {{ border: 1px solid #ccc; }}
    </style>
</head>
<body>
    <div class="container">
        <h1>êµ¬ë© ê²€ì¶œ ê²°ê³¼</h1>

        <!-- ìŠ¬ë¼ì´ë” ë¹„êµ -->
        <div id="comparison">
            <input type="range" class="slider"
                   min="0" max="100" value="50"
                   oninput="updateOpacity(this.value)">
            <canvas id="canvas"></canvas>
        </div>

        <!-- êµ¬ë© ëª©ë¡ -->
        <h2>ê²€ì¶œëœ êµ¬ë© (163ê°œ)</h2>
        <div id="holes-list">
            <!-- ë™ì  ìƒì„± -->
        </div>

        <!-- ë‹¤ìš´ë¡œë“œ ë§í¬ -->
        <h2>ë‹¤ìš´ë¡œë“œ</h2>
        <ul>
            <li><a href="all_holes_vector.svg">ì „ì²´ SVG</a></li>
            <li><a href="white_mask.png">ë§ˆìŠ¤í¬ ì´ë¯¸ì§€</a></li>
        </ul>
    </div>

    <script>
        // ìŠ¬ë¼ì´ë”ë¡œ íˆ¬ëª…ë„ ì¡°ì ˆ
        function updateOpacity(value) {{
            const overlay = document.getElementById('overlay');
            overlay.style.opacity = value / 100;
        }}

        // êµ¬ë© í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´
        function showHoleDetails(holeId) {{
            // SVG ë©”íƒ€ë°ì´í„° í‘œì‹œ
            fetch(`svg_vectors/hole_${{holeId}}.svg`)
                .then(r => r.text())
                .then(showDetails);
        }}
    </script>
</body>
</html>
"""

    with open(f"{result_dir}/viewer.html", "w", encoding="utf-8") as f:
        f.write(html)

    print(f"Viewer created: {result_dir}/viewer.html")
```

---

### 2.3 ìë™ ë³´ê³ ì„œ ìƒì„±

**íŒŒì¼**: `generate_report.py`

```python
"""
PDF/HTML ë³´ê³ ì„œ ìë™ ìƒì„±

í¬í•¨ ë‚´ìš©:
  - ì›ë³¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
  - êµ¬ë© ê²€ì¶œ í†µê³„
  - ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€
  - êµ¬ë© ëª©ë¡ (ìœ„ì¹˜, í¬ê¸°)
  - SVG ë‹¤ìš´ë¡œë“œ ë§í¬
"""

def generate_report(result_dir, format='html'):
    """ë³´ê³ ì„œ ìƒì„±"""

    # ë°ì´í„° ìˆ˜ì§‘
    stats = load_statistics(f"{result_dir}/stats.json")

    # HTML ë³´ê³ ì„œ
    if format == 'html':
        html = f"""
        <html>
        <body>
            <h1>ê³ ë¬¸ì„œ ì†ìƒ ê²€ì¶œ ë³´ê³ ì„œ</h1>
            <h2>ìš”ì•½</h2>
            <ul>
                <li>ì´ êµ¬ë© ê°œìˆ˜: {stats['total_holes']}</li>
                <li>í‰ê·  í¬ê¸°: {stats['avg_area']:.1f} í”½ì…€</li>
                <li>ì´ ì†ìƒ ë©´ì : {stats['total_area']:.1f} í”½ì…€</li>
            </ul>

            <h2>ì‹œê°í™”</h2>
            <img src="comparison.png" width="800">
            <img src="overlay_red.png" width="800">

            <h2>êµ¬ë© ëª©ë¡</h2>
            <table>
                <tr><th>ID</th><th>ìœ„ì¹˜</th><th>í¬ê¸°</th></tr>
                {generate_hole_table(stats['holes'])}
            </table>
        </body>
        </html>
        """

        with open(f"{result_dir}/report.html", "w") as f:
            f.write(html)

    # PDF ë³€í™˜
    if format == 'pdf':
        # weasyprint ë˜ëŠ” reportlab ì‚¬ìš©
        from weasyprint import HTML
        HTML(f"{result_dir}/report.html").write_pdf(
            f"{result_dir}/report.pdf"
        )
```

---

## Phase 3: ì‹¤ìš©í™” (ë°°í¬)

### ëª©í‘œ
- ì¼ë°˜ ì‚¬ìš©ìê°€ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡
- ì„¤ì¹˜ ë° ì‹¤í–‰ ê°„ì†Œí™”
- ì•ˆì •ì ì¸ ë°°í¬

---

### Option A: ì›¹ ì„œë¹„ìŠ¤ (ì¶”ì²œ) ğŸŒŸ

**ì¥ì **:
- ì„¤ì¹˜ ë¶ˆí•„ìš”
- ì–´ë””ì„œë‚˜ ì ‘ê·¼ ê°€ëŠ¥
- ì—…ë°ì´íŠ¸ ì‰¬ì›€
- ê²°ê³¼ ê³µìœ  ìš©ì´

**ê¸°ìˆ  ìŠ¤íƒ**:
```
Frontend: React + TypeScript
Backend: FastAPI (Python)
Storage: Local / S3
Deploy: Docker + Nginx
```

**êµ¬ì¡°**:
```
web_service/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageUpload.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultViewer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SVGDownloader.tsx
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py              # FastAPI ì„œë²„
â”‚   â”œâ”€â”€ detector.py          # ê¸°ì¡´ ì½”ë“œ ë˜í•‘
â”‚   â””â”€â”€ requirements.txt
â”‚
â””â”€â”€ docker-compose.yml
```

**API ì„¤ê³„**:
```python
# backend/main.py

from fastapi import FastAPI, UploadFile, File
from fastapi.responses import JSONResponse
import shutil

app = FastAPI()

@app.post("/api/detect")
async def detect_holes(
    file: UploadFile = File(...),
    threshold: int = 138,
    min_area: int = 50
):
    """êµ¬ë© ê²€ì¶œ API"""

    # íŒŒì¼ ì €ì¥
    file_path = f"temp/{file.filename}"
    with open(file_path, "wb") as f:
        shutil.copyfileobj(file.file, f)

    # ì²˜ë¦¬
    result = process_image(file_path, threshold, min_area)

    return {
        "holes": result['holes'],
        "svg_url": f"/results/{result['id']}/all_holes_vector.svg",
        "image_url": f"/results/{result['id']}/comparison.png"
    }


@app.get("/api/results/{result_id}")
async def get_result(result_id: str):
    """ê²°ê³¼ ì¡°íšŒ"""
    return load_result(result_id)


@app.get("/api/download/{result_id}/{file_type}")
async def download_file(result_id: str, file_type: str):
    """íŒŒì¼ ë‹¤ìš´ë¡œë“œ (SVG, PNG ë“±)"""
    file_path = f"results/{result_id}/{file_type}"
    return FileResponse(file_path)
```

**Frontend**:
```tsx
// frontend/src/App.tsx

function App() {
  const [image, setImage] = useState(null);
  const [result, setResult] = useState(null);

  const handleUpload = async (file) => {
    const formData = new FormData();
    formData.append('file', file);

    const response = await fetch('/api/detect', {
      method: 'POST',
      body: formData
    });

    const data = await response.json();
    setResult(data);
  };

  return (
    <div>
      <h1>ê³ ë¬¸ì„œ ì†ìƒ ê²€ì¶œ ì‹œìŠ¤í…œ</h1>

      <ImageUpload onUpload={handleUpload} />

      {result && (
        <ResultViewer
          holes={result.holes}
          imageUrl={result.image_url}
          svgUrl={result.svg_url}
        />
      )}
    </div>
  );
}
```

**ë°°í¬**:
```yaml
# docker-compose.yml

version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    volumes:
      - ./results:/app/results

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - frontend
      - backend
```

---

### Option B: ë°ìŠ¤í¬í†± ì•±

**ê¸°ìˆ  ìŠ¤íƒ**:
```
Electron + Python
ë˜ëŠ”
PyQt6 / PySide6
```

**ì¥ì **:
- ì˜¤í”„ë¼ì¸ ì‚¬ìš© ê°€ëŠ¥
- ë¡œì»¬ íŒŒì¼ ì ‘ê·¼ ì‰¬ì›€
- ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥

**êµ¬ì¡°**:
```
desktop_app/
â”œâ”€â”€ main.py                  # PyQt6 ë©”ì¸
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ main_window.py
â”‚   â”œâ”€â”€ result_viewer.py
â”‚   â””â”€â”€ settings_dialog.py
â”œâ”€â”€ core/
â”‚   â””â”€â”€ detector.py          # ê¸°ì¡´ ì½”ë“œ
â””â”€â”€ resources/
    â””â”€â”€ icons/
```

**ì˜ˆì‹œ**:
```python
# main.py (PyQt6)

from PyQt6.QtWidgets import QApplication, QMainWindow, QFileDialog
from PyQt6.QtCore import QThread, pyqtSignal

class DetectorThread(QThread):
    """ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬ ìŠ¤ë ˆë“œ"""
    finished = pyqtSignal(dict)

    def __init__(self, image_path, params):
        super().__init__()
        self.image_path = image_path
        self.params = params

    def run(self):
        result = process_image(self.image_path, **self.params)
        self.finished.emit(result)


class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("ê³ ë¬¸ì„œ ì†ìƒ ê²€ì¶œ")
        self.setup_ui()

    def setup_ui(self):
        # íŒŒì¼ ì„ íƒ ë²„íŠ¼
        self.btn_open = QPushButton("ì´ë¯¸ì§€ ì—´ê¸°")
        self.btn_open.clicked.connect(self.open_image)

        # ì²˜ë¦¬ ë²„íŠ¼
        self.btn_process = QPushButton("ê²€ì¶œ ì‹œì‘")
        self.btn_process.clicked.connect(self.start_detection)

        # ê²°ê³¼ ë·°ì–´
        self.result_viewer = ResultViewer()

    def open_image(self):
        file_path, _ = QFileDialog.getOpenFileName(
            self, "ì´ë¯¸ì§€ ì„ íƒ", "",
            "Images (*.tif *.jpg *.png)"
        )
        if file_path:
            self.image_path = file_path
            self.display_image(file_path)

    def start_detection(self):
        params = self.get_params()

        self.thread = DetectorThread(self.image_path, params)
        self.thread.finished.connect(self.show_result)
        self.thread.start()

    def show_result(self, result):
        self.result_viewer.display(result)


if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec())
```

**íŒ¨í‚¤ì§•**:
```bash
# PyInstallerë¡œ ì‹¤í–‰ íŒŒì¼ ìƒì„±
pyinstaller --onefile --windowed main.py

# ë˜ëŠ” cx_Freeze
python setup.py build
```

---

### Option C: CLI ë„êµ¬ + ê°„ë‹¨í•œ GUI (ì ˆì¶©ì•ˆ)

**ì¥ì **:
- ë¹ ë¥¸ êµ¬í˜„
- CLIì™€ GUI ë™ì‹œ ì œê³µ
- ìœ ì—°ì„±

**êµ¬ì¡°**:
```
cli_gui/
â”œâ”€â”€ cli.py                   # ê¸°ì¡´ extract_whiteness_based.py ê°œì„ 
â”œâ”€â”€ gui.py                   # ê°„ë‹¨í•œ tkinter GUI
â””â”€â”€ README.md
```

**GUI ì˜ˆì‹œ**:
```python
# gui.py (tkinter)

import tkinter as tk
from tkinter import filedialog, ttk
import subprocess

class SimpleGUI:
    def __init__(self, root):
        self.root = root
        root.title("ê³ ë¬¸ì„œ ì†ìƒ ê²€ì¶œ")

        # íŒŒì¼ ì„ íƒ
        ttk.Label(root, text="ì´ë¯¸ì§€:").grid(row=0, column=0)
        self.entry_file = ttk.Entry(root, width=50)
        self.entry_file.grid(row=0, column=1)
        ttk.Button(root, text="ì°¾ê¸°",
                  command=self.browse_file).grid(row=0, column=2)

        # íŒŒë¼ë¯¸í„°
        ttk.Label(root, text="Threshold:").grid(row=1, column=0)
        self.entry_threshold = ttk.Entry(root)
        self.entry_threshold.insert(0, "138")
        self.entry_threshold.grid(row=1, column=1)

        # ì‹¤í–‰ ë²„íŠ¼
        ttk.Button(root, text="ê²€ì¶œ ì‹œì‘",
                  command=self.run_detection).grid(row=5, column=1)

        # ë¡œê·¸
        self.text_log = tk.Text(root, height=20, width=80)
        self.text_log.grid(row=6, column=0, columnspan=3)

    def browse_file(self):
        filename = filedialog.askopenfilename(
            filetypes=[("Images", "*.tif *.jpg *.png")]
        )
        self.entry_file.delete(0, tk.END)
        self.entry_file.insert(0, filename)

    def run_detection(self):
        cmd = [
            "python", "extract_whiteness_based.py",
            "--input", self.entry_file.get(),
            "--s-threshold", self.entry_threshold.get(),
            # ...
        ]

        # ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
        process = subprocess.Popen(
            cmd,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )

        # ë¡œê·¸ í‘œì‹œ
        for line in process.stdout:
            self.text_log.insert(tk.END, line.decode())
            self.text_log.see(tk.END)


if __name__ == '__main__':
    root = tk.Tk()
    app = SimpleGUI(root)
    root.mainloop()
```

---

## íƒ€ì„ë¼ì¸

### Week 1: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
- **Day 1-2**: Phase 1 (ë°°ì¹˜ ì²˜ë¦¬)
  - [x] ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
  - [ ] ëª¨ë“  ì´ë¯¸ì§€ ì²˜ë¦¬
  - [ ] ê²°ê³¼ ê²€ì¦

- **Day 3-4**: Phase 2 (ì‹œê°í™”)
  - [ ] ë§ˆìŠ¤í¬ ì˜¤ë²„ë ˆì´
  - [ ] HTML ë·°ì–´
  - [ ] ë³´ê³ ì„œ ìƒì„±

### Week 2: ë°°í¬
- **Day 5-7**: Phase 3-A (ì›¹ ì„œë¹„ìŠ¤)
  - [ ] FastAPI ë°±ì—”ë“œ
  - [ ] React í”„ë¡ íŠ¸ì—”ë“œ
  - [ ] Docker ë°°í¬

- **ë˜ëŠ” Day 5-7**: Phase 3-B (ë°ìŠ¤í¬í†±)
  - [ ] PyQt6 GUI
  - [ ] íŒ¨í‚¤ì§•
  - [ ] ì„¤ì¹˜ í”„ë¡œê·¸ë¨

### Week 3: ê°œì„  ë° ë¬¸ì„œí™”
- **Day 8-10**:
  - [ ] ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜
  - [ ] ë¬¸ì„œí™” (ì‚¬ìš© ì„¤ëª…ì„œ)
  - [ ] ìµœì¢… í…ŒìŠ¤íŠ¸

---

## ê¸°ìˆ  ìŠ¤íƒ

### Phase 1-2: í…ŒìŠ¤íŠ¸ & ì‹œê°í™”
```
Python 3.9+
â”œâ”€â”€ OpenCV
â”œâ”€â”€ NumPy
â”œâ”€â”€ Pillow
â””â”€â”€ Matplotlib
```

### Phase 3-A: ì›¹ ì„œë¹„ìŠ¤
```
Backend:
â”œâ”€â”€ FastAPI
â”œâ”€â”€ Uvicorn
â”œâ”€â”€ Pydantic
â””â”€â”€ Python-multipart

Frontend:
â”œâ”€â”€ React 18
â”œâ”€â”€ TypeScript
â”œâ”€â”€ Axios
â””â”€â”€ TailwindCSS

Deploy:
â”œâ”€â”€ Docker
â”œâ”€â”€ Docker Compose
â””â”€â”€ Nginx
```

### Phase 3-B: ë°ìŠ¤í¬í†± ì•±
```
GUI:
â”œâ”€â”€ PyQt6 (ì¶”ì²œ)
â””â”€â”€ ë˜ëŠ” Electron + Python

íŒ¨í‚¤ì§•:
â”œâ”€â”€ PyInstaller
â””â”€â”€ ë˜ëŠ” cx_Freeze
```

### Phase 3-C: CLI + GUI
```
â”œâ”€â”€ Click (CLI ê°œì„ )
â”œâ”€â”€ Tkinter (ê°„ë‹¨í•œ GUI)
â””â”€â”€ tqdm (ì§„í–‰ë¥ )
```

---

## ìš°ì„ ìˆœìœ„ ê¶Œì¥

### ğŸ¥‡ 1ìˆœìœ„: ì›¹ ì„œë¹„ìŠ¤ (Option A)
**ì´ìœ **:
- âœ… ê°€ì¥ ì ‘ê·¼ì„± ì¢‹ìŒ
- âœ… ì„¤ì¹˜ ë¶ˆí•„ìš”
- âœ… ê²°ê³¼ ê³µìœ  ì‰¬ì›€
- âœ… ì—…ë°ì´íŠ¸ ê´€ë¦¬ ìš©ì´
- âœ… í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ í™œìš© ê°€ëŠ¥

### ğŸ¥ˆ 2ìˆœìœ„: CLI + ê°„ë‹¨í•œ GUI (Option C)
**ì´ìœ **:
- âœ… ë¹ ë¥¸ êµ¬í˜„
- âœ… ê¸°ì¡´ ì½”ë“œ ì¬ì‚¬ìš©
- âœ… CLIì™€ GUI ëª¨ë‘ ì œê³µ
- âš ï¸ ê³ ê¸‰ ê¸°ëŠ¥ ì œí•œì 

### ğŸ¥‰ 3ìˆœìœ„: ë°ìŠ¤í¬í†± ì•± (Option B)
**ì´ìœ **:
- âœ… ì˜¤í”„ë¼ì¸ ì‚¬ìš©
- âš ï¸ ê°œë°œ ì‹œê°„ ë§ì´ ì†Œìš”
- âš ï¸ ê° OSë³„ ë¹Œë“œ í•„ìš”
- âš ï¸ ì—…ë°ì´íŠ¸ ë°°í¬ ë³µì¡

---

## í•„ìš”í•œ ì¶”ê°€ ì‘ì—…

### ê³µí†µ
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ê°œì„ 
- [ ] ë¡œê¹… ì‹œìŠ¤í…œ
- [ ] ì„¤ì • íŒŒì¼ (config.yaml)
- [ ] ì‚¬ìš©ì ë§¤ë‰´ì–¼

### ì›¹ ì„œë¹„ìŠ¤ (Option A)
- [ ] ì‚¬ìš©ì ì¸ì¦ (ì„ íƒ)
- [ ] íŒŒì¼ ì—…ë¡œë“œ ì œí•œ
- [ ] ê²°ê³¼ ì €ì¥ ê¸°ê°„ ì„¤ì •
- [ ] HTTPS ì„¤ì •

### ë°ìŠ¤í¬í†± ì•± (Option B)
- [ ] ìë™ ì—…ë°ì´íŠ¸
- [ ] ì„¤ì • ì €ì¥/ë¡œë“œ
- [ ] ë°°ì¹˜ ì²˜ë¦¬ UI
- [ ] ì§„í–‰ë¥  í‘œì‹œ

---

## ì˜ˆìƒ ë¦¬ì†ŒìŠ¤

### ê°œë°œ ì‹œê°„
- Phase 1: 2ì¼
- Phase 2: 2ì¼
- Phase 3-A (ì›¹): 5ì¼
- Phase 3-B (ë°ìŠ¤í¬í†±): 5ì¼
- Phase 3-C (CLI+GUI): 2ì¼

### ì„œë²„ ìŠ¤í™ (ì›¹ ì„œë¹„ìŠ¤)
```
ìµœì†Œ:
- CPU: 4 cores
- RAM: 8GB
- Storage: 100GB SSD

ê¶Œì¥:
- CPU: 8 cores
- RAM: 16GB
- Storage: 500GB SSD
- GPU: NVIDIA (ì„ íƒ, ì†ë„ í–¥ìƒ)
```

---

## ë‹¤ìŒ ì•¡ì…˜ ì•„ì´í…œ

### ì¦‰ì‹œ ì‹œì‘
1. [ ] `batch_process.py` ì‘ì„±
2. [ ] ì „ì²´ ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘
3. [ ] ê²°ê³¼ í’ˆì§ˆ ê²€ì¦

### ë³‘ë ¬ ì§„í–‰ ê°€ëŠ¥
- [ ] `create_overlay.py` ì‘ì„±
- [ ] HTML ë·°ì–´ í”„ë¡œí† íƒ€ì…
- [ ] ì›¹ ì„œë¹„ìŠ¤ API ì„¤ê³„

### ê²°ì • í•„ìš”
- [ ] ë°°í¬ ë°©ì‹ ì„ íƒ (A/B/C)
- [ ] ì„œë²„ ì¤€ë¹„ (ì›¹ ì„œë¹„ìŠ¤ ì„ íƒ ì‹œ)
- [ ] ë„ë©”ì¸ ë“±ë¡ (ì›¹ ì„œë¹„ìŠ¤ ì„ íƒ ì‹œ)

---

## ì°¸ê³  ìë£Œ

### í˜„ì¬ êµ¬í˜„ëœ ê¸°ëŠ¥
- `worklog/2025-10-30_tile_aware_document_boundary_detection.md`
- `worklog/2025-10-30_svg_optimization_and_visualization.md`
- `worklog/FINAL_SUMMARY_hole_detection_b138.md`

### ìœ ì‚¬ í”„ë¡œì íŠ¸
- IIIF Image API (ì´ë¯¸ì§€ ì„œë¹„ìŠ¤)
- OpenCV.js (ì›¹ ë¸Œë¼ìš°ì € CV)
- Papermill (ë¬¸ì„œ ìŠ¤ìº” ì•±)

---

**ì‘ì„±ì**: Claude Code
**ë‚ ì§œ**: 2025-10-30
**í”„ë¡œì íŠ¸**: ê³ ë¬¸ì„œ ì†ìƒ ìë™ ê²€ì¶œ ì‹œìŠ¤í…œ
**ìƒíƒœ**: ê³„íš ë‹¨ê³„
